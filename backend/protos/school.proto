syntax = "proto3";
package school;

message Empty {}

message Student {
  int64 id = 1;
  string name = 2;
}

message Teacher {
  int64 id = 1;
  string name = 2;
}

message Subject {
  int64 id = 1;
  string name = 2;
  int64 teacher_id = 3;
}

message Class {
  int64 id = 1;
  int64 subject_id = 2;
  repeated int64 student_ids = 3;
  string schedule = 4; // exemplo: "Seg 08:00-10:00"
}

message Id {
  int64 id = 1;
}

message EnrollRequest {
  int64 class_id = 1;
  int64 student_id = 2;
}

message CreateClassRequest {
  int64 subject_id = 1;
  string schedule = 2;
  int64 teacher_id = 3; // usado para autorizar: o professor que tenta criar a turma
}

message StudentList { repeated Student students = 1; }
message TeacherList { repeated Teacher teachers = 1; }
message SubjectList { repeated Subject subjects = 1; }
message ClassList { repeated Class classes = 1; }

service SchoolService {
  // Students
  rpc CreateStudent(Student) returns (Student);
  rpc GetStudent(Id) returns (Student);
  rpc ListStudents(Empty) returns (StudentList);
  rpc UpdateStudent(Student) returns (Student);
  rpc DeleteStudent(Id) returns (Empty);

  // Teachers
  rpc CreateTeacher(Teacher) returns (Teacher);
  rpc GetTeacher(Id) returns (Teacher);
  rpc ListTeachers(Empty) returns (TeacherList);
  rpc UpdateTeacher(Teacher) returns (Teacher);
  rpc DeleteTeacher(Id) returns (Empty);

  // Subjects
  rpc CreateSubject(Subject) returns (Subject);
  rpc GetSubject(Id) returns (Subject);
  rpc ListSubjects(Empty) returns (SubjectList);
  rpc UpdateSubject(Subject) returns (Subject);
  rpc DeleteSubject(Id) returns (Empty);
  rpc GetSubjectsByTeacher(Id) returns (SubjectList);

  // Classes (turmas) -- note: Class doesn't carry teacher_id; teacher is implicit via Subject.teacher_id
  rpc CreateClass(CreateClassRequest) returns (Class);
  rpc GetClass(Id) returns (Class);
  rpc ListClasses(Empty) returns (ClassList);
  rpc UpdateClass(Class) returns (Class);
  rpc DeleteClass(Id) returns (Empty);

  // Filters
  rpc GetClassesByTeacher(Teacher) returns (ClassList);
  rpc GetClassesBySubject(Subject) returns (ClassList);

  // Enrollment
  rpc EnrollStudentInClass(EnrollRequest) returns (Class);
}